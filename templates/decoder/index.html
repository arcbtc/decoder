{% extends "base.html" %} {% from "macros.jinja" import window_vars with context
%} {% block page %}

<div class="row q-col-gutter-md">
  <div class="col-12 col-md-7 q-gutter-y-md">
    <q-card flat>
  <q-card-section>
    <div class="row items-center no-wrap q-mb-sm">
      <div class="col">
        <strong>
          Decode Lightning
          BOLT11, LNURL, and Lightning Address
        </strong>
      </div>
    </div>
    <div class="row items-center no-wrap q-mb-sm">
      <div class="col">
        <q-input filled dense clearable placeholder="Enter Invoice...." class="q-mb-md">
        </q-input>
        <q-btn unelevated color="primary" class="" @click="showParseDialog" :label="$t('go')"></q-btn>
      </div>
    </div>
  </q-card-section>
    </q-card>
  </div>

  <div class="col-12 col-md-5 q-gutter-y-md">
    <q-card>
      <q-card-section>
        <h6 class="text-subtitle1 q-my-none">
          {{ SITE_TITLE }} Decoder extension
        </h6>
      </q-card-section>
      <q-card-section class="q-pa-none">
        <q-separator></q-separator>
        <q-list>
          {% include "decoder/_decoder.html" %}
        </q-list>
      </q-card-section>
    </q-card>
  </div>

</div>
{% endblock %} {% block scripts %} {{ window_vars(user) }}

<script>
  var someMapObject = obj => {
    obj._data = _.clone(obj)
    obj.date = Quasar.utils.date.formatDate(
      new Date(obj.time * 1000),
      'YYYY-MM-DD HH:mm'
    )
    // here you can do something with the mapped data
    return obj
  }
  new Vue({
    el: '#vue',
    mixins: [windowMixin],
    data: function () {
      return {
        ///// Declare models/variables /////
        protocol: window.location.protocol,
        location: '//' + window.location.hostname,
        thingDialog: {
          show: false,
          data: {}
        },
        someBool: true,
        splitterModel: 20,
        decoderData: [],
        tab: 'frameworks',
        framworktab: 'fastapi',
        usefultab: 'magicalg'
      }
    },
    ///// Where functions live /////
    methods: {
      decoderFunction: function (data) {
        var theData = data
        LNbits.api
          .request(
            'GET', // Type of request
            '/decoder/api/v1/test/' + theData, // URL of the endpoint
            this.g.user.wallets[0].inkey // Often endpoints require a key
          )
          .then(response => {
            this.decoderData = response.data.map(someMapObject) // Often whats returned is mapped onto some model
          })
          .catch(error => {
            LNbits.utils.notifyApiError(error) // Error will be passed to the frontend
          })
      },
      sendThingDialog() {
        console.log(this.thingDialog)
      }
    },
    ///// To run on startup /////
    created: function () {
      self = this // Often used to run a real object, rather than the event (all a bit confusing really)
      self.decoderFunction('lorum')
    }
  })
</script>
{% endblock %}